import{_ as P,c as Q,o as d,w as i,a as r,b as t,Q as g,e as h,f as p,aq as f,a5 as c,a6 as b,a7 as v,t as l,a1 as q,d as k,Z as U,at as E,h as D}from"./index-D7Xk6GjO.js";import{Q as S}from"./QPagination-iE4BXy_d.js";import{Q as x}from"./QImg-CRjqfzB0.js";import{Q as y}from"./QMarkupTable-C2kEUEae.js";import{Q as C}from"./QForm-BfWQ8kbk.js";import{Q as B}from"./QSpace-ncsPi7l_.js";import{Q as _}from"./QSelect-Cfk1k3Zg.js";import{Q as G}from"./QPage-BKNHMEr0.js";import{I as V}from"./Imprimir-CwwATIwK.js";import"./format-BvkBI9bc.js";import"./QChip-CTRdjuvH.js";import"./QMenu-CgzrJreP.js";import"./_commonjsHelpers-Bx2EM-6T.js";import"./moment-C5S46NFB.js";const N={name:"ComprasCreate",data(){return{loading:!1,compraDialog:!1,productos:[],productosSearch:"",productosCompras:[],proveedores:[],proveedor:null,compra:{nit:"",nombre:"",tipo_pago:"Efectivo"},pagination:{page:1,rowsPerPage:24,rowsNumber:0},observaciones:""}},computed:{totalCompra(){let s=0;return this.productosCompras.forEach(e=>{s+=e.cantidad*e.precio}),parseFloat(s).toFixed(2)}},methods:{registrarPedido(){if(this.productosCompras.length===0){this.$alert.error("Debe agregar al menos un producto");return}this.$q.dialog({title:"Registrar pedido",message:"¿Está seguro de registrar el pedido?",cancel:!0,persistent:!0}).onOk(()=>{this.loading=!0,this.$axios.post("pedidos",{productos:this.productosCompras,observaciones:this.observaciones}).then(s=>{this.$alert.success("Pedido registrado correctamente"),this.productosCompras=[],V.reciboPedido(s.data)}).catch(s=>{console.error("Error registrando pedido:",s),this.$alert.error("Error al registrar el pedido")}).finally(()=>{this.loading=!1})})},updatePrecioVenta(s){const e=Math.ceil(s.precio*s.factor);s.precio_venta=e},productosGet(){this.loading=!0,this.$axios.get("productos",{params:{search:this.productosSearch,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(s=>{this.productos=s.data.data,this.pagination.rowsNumber=s.data.total}).catch(s=>{console.error("Error cargando productos:",s)}).finally(()=>{this.loading=!1})},addProducto(s){const e=this.productosCompras.find(w=>w.producto_id===s.id);e?e.cantidad+=1:this.productosCompras.push({producto_id:s.id,cantidad:1,precio:"",lote:"",fecha_vencimiento:"",producto:s,factor:1.25})},clickDialogCompra(){if(this.productosCompras.length===0){this.$alert.error("Debe agregar al menos un producto");return}if(this.productosCompras.filter(e=>!e.precio).length>0){this.$alert.error("Todos los productos deben tener precio unitario");return}this.compraDialog=!0},buscarProveedor(){this.compra.nit&&(this.loading=!0,this.$axios.post("searchProveedor",{nit:this.compra.nit}).then(s=>{s.data?.nombre&&(this.compra.nombre=s.data.nombre)}).catch(s=>{console.warn("Proveedor no encontrado",s)}).finally(()=>{this.loading=!1}))},submitCompra(){this.loading=!0;const s={tipo_pago:this.compra.tipo_pago,proveedor_id:this.proveedor.id,nro_factura:this.compra.nro_factura,productos:this.productosCompras,agencia:this.compra.agencia};this.$axios.post("compras",s).then(e=>{this.$alert.success("Compra registrada correctamente"),this.compraDialog=!1,this.productosCompras=[],V.reciboCompra(e.data),this.productosGet(),this.compra={nit:"",nombre:"",tipo_pago:"Efectivo"},this.proveedor=null}).catch(e=>{console.error("Error registrando compra:",e),this.$alert.error("Error al registrar la compra")}).finally(()=>{})},proveedoresGet(){this.$axios.get("proveedores").then(s=>{this.proveedores=s.data}).catch(s=>{console.error("Error cargando proveedores:",s)}).finally(()=>{})}},mounted(){this.productosGet(),this.proveedoresGet()}},F={class:"row"},I={class:"col-12 col-md-7 q-pa-xs"},T={class:"flex flex-center"},M={class:"row"},R={class:"col-6 col-md-2"},$={class:"absolute-bottom text-center",style:{padding:"0",margin:"0"}},z={style:{"max-width":"190px","line-height":"0.9"}},K={style:{display:"flex","justify-content":"space-between"}},L={class:"text-bold bg-orange text-black border"},O={class:"col-12 col-md-5 q-pa-xs"},j={class:"pm-none",style:{display:"flex","align-items":"center"}},A={style:{"max-width":"120px","wrap-option":"warp","line-height":"0.9"}},Z={class:"pm-none"},H=["onUpdate:modelValue","onKeyup","onUpdate"],J={class:"row"},W={class:"col-12 col-md-6 q-pa-xs"},X={class:"col-12 col-md-6 q-pa-xs"},Y={class:"col-12 col-md-6 q-pa-xs"},ee={class:"col-12 col-md-6 q-pa-xs"},oe={class:"col-12"},te={class:"pm-none",style:{display:"flex","align-items":"center"}},se={style:{"max-width":"120px","wrap-option":"warp","line-height":"0.9"}},re={class:"pm-none"},ae={class:"pm-none text-red text-bold text-right"},ie={class:"pm-none"},le={class:"pm-none"};function ne(s,e,w,de,a,n){return d(),Q(G,{class:"q-pa-xs"},{default:i(()=>[r(g,{flat:"",bordered:""},{default:i(()=>[r(h,{class:"row items-center q-pb-none"},{default:i(()=>[e[11]||(e[11]=t("div",{class:"text-h6"},"Compras",-1)),r(p,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:e[0]||(e[0]=o=>s.$router.go(-1))})]),_:1}),r(h,{class:"q-pa-none"},{default:i(()=>[r(C,{onSubmit:n.registrarPedido},{default:i(()=>[t("div",F,[t("div",I,[r(f,{modelValue:a.productosSearch,"onUpdate:modelValue":[e[1]||(e[1]=o=>a.productosSearch=o),n.productosGet],outlined:"",clearable:"",label:"Buscar producto",dense:"",debounce:"300"},{append:i(()=>[r(p,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),t("div",T,[r(S,{modelValue:a.pagination.page,"onUpdate:modelValue":[e[2]||(e[2]=o=>a.pagination.page=o),n.productosGet],max:Math.ceil(a.pagination.rowsNumber/a.pagination.rowsPerPage),"max-pages":"5",size:"xs","boundary-numbers":"",class:"q-mt-sm"},null,8,["modelValue","max","onUpdate:modelValue"])]),t("div",M,[(d(!0),c(b,null,v(a.productos,o=>(d(),c("div",R,[r(g,{flat:"",bordered:"",class:"cursor-pointer",onClick:m=>n.addProducto(o)},{default:i(()=>[r(x,{src:`${s.$url}../images/${o.imagen}`,class:"q-mb-xs",style:{height:"120px"}},{default:i(()=>[t("div",$,[t("div",z,l(s.$filters.textUpper(o.nombre)),1),t("div",K,[t("span",null,l(o.stock),1),t("span",L,l(o.precio)+" Bs",1)])])]),_:2},1032,["src"])]),_:2},1032,["onClick"])]))),256))])]),t("div",O,[t("div",null,[r(p,{size:"xs",flat:"",round:"",dense:"",icon:"delete",color:"red",onClick:e[3]||(e[3]=o=>a.productosCompras=[]),class:"q-mb-sm"}),e[12]||(e[12]=t("span",{class:"text-subtitle2"},"Productos seleccionados",-1))]),r(y,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:i(()=>[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Producto"),t("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Cantidad")])],-1)),t("tbody",null,[(d(!0),c(b,null,v(a.productosCompras,(o,m)=>(d(),c("tr",{key:m},[t("td",j,[r(x,{src:`${s.$url}../images/${o.producto?.imagen}`,class:"q-mb-xs",style:{height:"35px",width:"35px"}},null,8,["src"]),t("div",A,[r(k,{name:"delete",color:"red",class:"cursor-pointer",onClick:u=>a.productosCompras.splice(m,1)},null,8,["onClick"]),q(" "+l(s.$filters.textUpper(o.producto?.nombre)),1)])]),t("td",Z,[U(t("input",{"onUpdate:modelValue":u=>o.cantidad=u,type:"number",style:{width:"50px"},onKeyup:u=>n.updatePrecioVenta(o),onUpdate:u=>n.updatePrecioVenta(o)},null,40,H),[[E,o.cantidad]])])]))),128))]),e[14]||(e[14]=t("tfoot",null,null,-1))]),_:1}),r(f,{modelValue:a.observaciones,"onUpdate:modelValue":e[4]||(e[4]=o=>a.observaciones=o),outlined:"",dense:"",label:"Observaciones",class:"q-mt-md",type:"textarea"},null,8,["modelValue"]),r(p,{label:"Registrar pedido",color:"green",class:"full-width","no-caps":"",loading:a.loading,type:"submit",icon:"add_circle_outline"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1}),r(D,{modelValue:a.compraDialog,"onUpdate:modelValue":e[10]||(e[10]=o=>a.compraDialog=o)},{default:i(()=>[r(g,{style:{width:"600px"}},{default:i(()=>[r(h,{class:"row items-center q-pb-none"},{default:i(()=>[e[15]||(e[15]=t("div",{class:"text-h6"},"Confirmar compra",-1)),r(B),r(p,{flat:"",round:"",dense:"",icon:"close",onClick:e[5]||(e[5]=o=>a.compraDialog=!1)})]),_:1}),r(h,null,{default:i(()=>[r(C,{onSubmit:n.submitCompra},{default:i(()=>[t("div",J,[t("div",W,[r(_,{modelValue:a.proveedor,"onUpdate:modelValue":[e[6]||(e[6]=o=>a.proveedor=o),n.buscarProveedor],options:a.proveedores,"option-label":"nombre","option-value":"id",label:"Proveedor",dense:"",outlined:"",rules:[o=>!!o||"Campo requerido",o=>(o&&(this.compra.nit=o.nit,this.compra.nombre=o.nombre),!0)]},null,8,["modelValue","options","onUpdate:modelValue","rules"])]),t("div",X,[r(_,{modelValue:a.compra.tipo_pago,"onUpdate:modelValue":e[7]||(e[7]=o=>a.compra.tipo_pago=o),options:["Efectivo","QR"],label:"Tipo de pago",dense:"",outlined:""},null,8,["modelValue"])]),t("div",Y,[r(f,{modelValue:a.compra.nro_factura,"onUpdate:modelValue":e[8]||(e[8]=o=>a.compra.nro_factura=o),outlined:"",dense:"",label:"Nro. factura"},null,8,["modelValue"])]),t("div",ee,[r(_,{modelValue:a.compra.agencia,"onUpdate:modelValue":e[9]||(e[9]=o=>a.compra.agencia=o),options:s.$agencias,label:"Agencia",dense:"",outlined:"",rules:[o=>!!o||"Campo requerido"]},null,8,["modelValue","options","rules"])]),t("div",oe,[r(y,{flat:"",dense:"","wrap-cells":"",bordered:""},{default:i(()=>[e[16]||(e[16]=t("thead",null,[t("tr",null,[t("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Producto"),t("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Cantidad"),t("th",{class:"pm-none",style:{"max-width":"60px","line-height":"0.9"}},"Precio venta"),t("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Lote"),t("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Fecha vencimiento")])],-1)),t("tbody",null,[(d(!0),c(b,null,v(a.productosCompras,(o,m)=>(d(),c("tr",{key:m},[t("td",te,[r(x,{src:`${s.$url}../images/${o.producto?.imagen}`,class:"q-mb-xs",style:{height:"35px",width:"35px"}},null,8,["src"]),t("div",se,l(s.$filters.textUpper(o.producto?.nombre)),1)]),t("td",re,l(o.cantidad),1),t("td",ae,l(o.precio_venta)+" Bs ",1),t("td",ie,l(o.lote),1),t("td",le,l(o.fecha_vencimiento),1)]))),128))])]),_:1})])]),r(p,{label:"Guardar compra",color:"primary",class:"full-width q-mt-md",type:"submit","no-caps":"",icon:"save",loading:a.loading},null,8,["loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[17]||(e[17]=t("div",{id:"myElement",class:"hidden"},null,-1))]),_:1})}const Ve=P(N,[["render",ne]]);export{Ve as default};
