import{_ as w,a5 as x,o as u,a as e,b as i,w as t,Q as I,e as E,d as m,a1 as r,t as d,aq as N,f as k,Z as p,c as h,a2 as g,a6 as A,a7 as y,a4 as C,as as O,h as Q}from"./index-D7Xk6GjO.js";import{Q as f,a as n,b as _}from"./QMenu-CgzrJreP.js";import{Q as D}from"./QSelect-Cfk1k3Zg.js";import{Q as S,C as v}from"./ClosePopup-C30NQmyp.js";import{Q as V}from"./QChip-CTRdjuvH.js";import{Q as F}from"./QMarkupTable-C2kEUEae.js";import{Q as M}from"./QPage-BKNHMEr0.js";import{h as R}from"./moment-C5S46NFB.js";import{I as U}from"./Imprimir-CwwATIwK.js";import{E as q}from"./Excel-DYSTQ5HC.js";import"./format-BvkBI9bc.js";import"./_commonjsHelpers-Bx2EM-6T.js";const L={name:"Ventas",data(){return{dialogEvento:!1,codigoMotivoEvento:null,eventos:[{label:"1 - CORTE DEL SERVICIO DE INTERNET",value:1},{label:"2 - INACCESIBILIDAD AL SERVICIO WEB DE LA ADMINISTRACIÓN TRIBUTARIA",value:2},{label:"3 - INGRESO A ZONAS SIN INTERNET POR DESPLIEGUE DE PUNTO DE VENTA EN VEHICULOS AUTOMOTORES",value:3},{label:"4 - VENTA EN LUGARES SIN INTERNET",value:4},{label:"5 - VIRUS INFORMÁTICO O FALLA DE SOFTWARE",value:5},{label:"6 - CAMBIO DE INFRAESTRUCTURA DEL SISTEMA INFORMÁTICO DE FACTURACIÓN O FALLA DE HARDWARE",value:6},{label:"7 - CORTE DE SUMINISTRO DE ENERGIA ELECTRICA",value:7}],ventas:[],venta:{},ventaDialog:!1,fechaInicio:R().format("YYYY-MM-DD"),fechaFin:R().format("YYYY-MM-DD"),loading:!1,actionPeriodo:"",gestiones:[],users:[],user:"",filter:"",roles:["Doctor","Enfermera","Administrativo","Secretaria"],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"nombre",label:"Nombre",align:"left",field:"nombre"},{name:"descripcion",label:"Descripción",align:"left",field:"descripcion"},{name:"unidad",label:"Unidad",align:"left",field:"unidad"},{name:"precio",label:"Precio",align:"left",field:"precio"},{name:"stock",label:"Stock",align:"left",field:"stock"},{name:"stock_minimo",label:"Stock mínimo",align:"left",field:"stock_minimo"},{name:"stock_maximo",label:"Stock máximo",align:"left",field:"stock_maximo"}]}},mounted(){this.ventasGet(),this.usersGet()},methods:{exportExcel(){let o=[{columns:[{label:"ID",value:"id"},{label:"Fecha",value:"fecha"},{label:"Cliente",value:"cliente.nombre"},{label:"Usuario",value:"user.name"},{label:"Estado",value:"estado"},{label:"Total",value:"total"},{label:"Detalle",value:"detailsText"}],content:this.ventas}];q.export(o,"Ventas")},usersGet(){this.$axios.get("users").then(o=>{this.users=o.data}).catch(o=>{this.$alert.error(o.response.data.message)})},imprimir(o){U.printFactura(o)},tipoVentasChange(o){this.$axios.put(`tipoVentasChange/${o}`).then(l=>{this.$alert.success("Tipo de venta cambiado"),this.ventasGet()}).catch(l=>{this.$alert.error(l.response.data.message)})},imprimirImpuestos(o){window.open(this.$store.env.url2+`consulta/QR?nit=${this.$store.env.nit}&cuf=${o.cuf}&numero=${o.id}&t=2`,"_blank")},verificarImpuestos(o){this.loading=!0,this.$axios.post(`verificarImpuestos/${o.cuf}`).then(l=>{this.$q.dialog({title:"Verificación de impuestos",fullWidth:!0,message:"<pre>"+JSON.stringify(l.data,null,2)+"</pre>",html:!0,ok:!0})}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},validarPaquete(o){this.loading=!0,this.$axios.post("validarPaquete",{venta_id:o.id}).then(l=>{this.$q.dialog({title:"Validación de paquete",fullWidth:!0,message:"<pre>"+JSON.stringify(l.data,null,2)+"</pre>",html:!0,ok:!0}),this.ventasGet()}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},dialogEventoClick(o){this.dialogEvento=!0,this.venta=o,this.codigoMotivoEvento=null},anular(o){this.$alert.dialog("¿Está seguro de anular la venta?").onOk(()=>{this.loading=!0,this.$axios.put(`ventasAnular/${o}`).then(l=>{this.$alert.success("Venta anulada"),this.ventasGet()}).catch(l=>{this.$alert.error(l.response.data.message)})})},ventasGet(){this.loading=!0,this.$axios.get("ventas",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user}}).then(o=>{this.ventas=o.data}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})}},computed:{usersTodos(){return[{label:"Todos",value:""},...this.users.map(o=>({label:o.name,value:o.id}))]},totalInternos(){return this.ventas.reduce((o,l)=>l.tipo_venta==="Interno"&&l.estado==="Activo"?o+parseFloat(l.total):o,0)},totalExternos(){return this.ventas.reduce((o,l)=>l.tipo_venta==="Externo"&&l.estado==="Activo"?o+parseFloat(l.total):o,0)}}},G={class:"row"},B={class:"col-12 col-md-4 q-pa-xs"},P={class:"col-12 col-md-4 q-pa-xs"},z={class:"col-12 col-md-4 q-pa-xs"},Y={class:"col-12"},W={class:"row"},$={class:"col-12 col-md-2"},H={class:"col-12 col-md-2"},J={class:"col-12 col-md-2"},Z={class:"col-12 col-md-2"},j={class:"col-12 col-md-2 text-right"},K={class:"col-12 col-md-2 text-right"},X={class:"text-bold"},ee={style:{"max-width":"200px","wrap-option":"wrap","line-height":"0.9"}};function le(o,l,te,ae,s,c){return u(),x(A,null,[e(M,{class:"q-pa-xs"},{default:t(()=>[i("div",G,[i("div",B,[e(I,{flat:"",bordered:""},{default:t(()=>[e(E,{class:"q-pa-none"},{default:t(()=>[e(f,{class:"bg-indigo"},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"trending_up",size:"50px",color:"white"})]),_:1}),e(n,null,{default:t(()=>[e(_,{caption:"",class:"text-white"},{default:t(()=>l[7]||(l[7]=[r("Cantidad de Ventas")])),_:1}),e(_,{class:"text-white text-h4"},{default:t(()=>[r(d(s.ventas.filter(a=>a.estado==="Activo").length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),i("div",P,[e(I,{flat:"",bordered:""},{default:t(()=>[e(E,{class:"q-pa-none"},{default:t(()=>[e(f,{class:"bg-green"},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),e(n,null,{default:t(()=>[e(_,{caption:"",class:"text-white"},{default:t(()=>l[8]||(l[8]=[r("Ventas Total")])),_:1}),e(_,{class:"text-white text-h4"},{default:t(()=>[r(d(s.ventas.filter(a=>a.estado==="Activo").reduce((a,T)=>a+parseFloat(T.total),0))+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),i("div",z,[e(I,{flat:"",bordered:""},{default:t(()=>[e(E,{class:"q-pa-none"},{default:t(()=>[e(f,{class:"bg-red"},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),e(n,null,{default:t(()=>[e(_,{caption:"",class:"text-white"},{default:t(()=>l[9]||(l[9]=[r("Ventas Anuladas")])),_:1}),e(_,{class:"text-white text-h4"},{default:t(()=>[r(d(s.ventas.filter(a=>a.estado==="Anulada").length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),i("div",Y,[e(I,{flat:"",bordered:""},{default:t(()=>[e(E,{class:"q-pa-none"},{default:t(()=>[i("div",W,[i("div",$,[e(N,{modelValue:s.fechaInicio,"onUpdate:modelValue":l[0]||(l[0]=a=>s.fechaInicio=a),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),i("div",H,[e(N,{modelValue:s.fechaFin,"onUpdate:modelValue":l[1]||(l[1]=a=>s.fechaFin=a),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),i("div",J,[e(D,{modelValue:s.user,"onUpdate:modelValue":l[2]||(l[2]=a=>s.user=a),options:c.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),i("div",Z,[e(k,{color:"primary",label:"Buscar","no-caps":"",icon:"search",loading:s.loading,onClick:l[3]||(l[3]=a=>c.ventasGet())},null,8,["loading"])]),i("div",j,[e(S,{color:"primary",label:"Exportar","no-caps":""},{default:t(()=>[p((u(),h(f,{clickable:"",onClick:c.exportExcel},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"file_download"})]),_:1}),e(n,null,{default:t(()=>l[10]||(l[10]=[r("Excel")])),_:1})]),_:1},8,["onClick"])),[[g],[v]])]),_:1})]),i("div",K,[e(k,{color:"positive",label:"Nueva venta","no-caps":"",icon:"add_circle_outline",loading:s.loading,to:"/ventaNuevo"},null,8,["loading"])])])]),_:1})]),_:1})])]),e(F,{dense:"","wrap-cells":""},{default:t(()=>[l[17]||(l[17]=i("thead",null,[i("tr",{class:"bg-primary text-white"},[i("th",null,"Acciones"),i("th",null,"ID"),i("th",null,"Fecha"),i("th",null,"Cliente"),i("th",null,"Usuario"),i("th",null,"Estado"),i("th",null,"Total"),i("th",null,"Detalle"),i("th",null,"Linea")])],-1)),i("tbody",null,[s.ventas.length!=0?(u(!0),x(A,{key:0},y(s.ventas,(a,T)=>(u(),x("tr",{key:a.id},[i("td",null,[e(S,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px",loading:s.loading},{default:t(()=>[p((u(),h(f,{clickable:"",onClick:b=>c.imprimir(a)},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"print"})]),_:1}),e(n,null,{default:t(()=>l[11]||(l[11]=[r("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[g],[v]]),a.cuf?p((u(),h(f,{key:0,clickable:"",onClick:b=>c.verificarImpuestos(a)},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"fact_check"})]),_:1}),e(n,null,{default:t(()=>l[12]||(l[12]=[r("Verificar impuestos")])),_:1})]),_:2},1032,["onClick"])),[[g],[v]]):C("",!0),a.cuf?p((u(),h(f,{key:1,clickable:"",onClick:b=>c.imprimirImpuestos(a)},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"receipt_long"})]),_:1}),e(n,null,{default:t(()=>l[13]||(l[13]=[r("Imprimir impuesto")])),_:1})]),_:2},1032,["onClick"])),[[g],[v]]):C("",!0),p((u(),h(f,{clickable:"",onClick:b=>c.anular(a.id)},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"delete"})]),_:1}),e(n,null,{default:t(()=>l[14]||(l[14]=[r("Anular")])),_:1})]),_:2},1032,["onClick"])),[[g],[v]]),a.online?C("",!0):p((u(),h(f,{key:2,clickable:"",onClick:b=>c.dialogEventoClick(a)},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"event"})]),_:1}),e(n,null,{default:t(()=>l[15]||(l[15]=[r("Evento significativo")])),_:1})]),_:2},1032,["onClick"])),[[g],[v]]),a.online?C("",!0):p((u(),h(f,{key:3,clickable:"",onClick:b=>c.validarPaquete(a)},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"verified"})]),_:1}),e(n,null,{default:t(()=>l[16]||(l[16]=[r("Validar paquete")])),_:1})]),_:2},1032,["onClick"])),[[g],[v]])]),_:2},1032,["loading"])]),i("td",null,d(a.id),1),i("td",null,d(a.fecha)+" "+d(a.hora),1),i("td",null,d(a.cliente.nombre),1),i("td",null,d(a.user.name),1),i("td",null,[e(V,{color:a.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:t(()=>[r(d(a.estado),1)]),_:2},1032,["color"])]),i("td",X,[r(d(a.total)+" ",1),e(V,{size:"10px",color:a.tipo_pago==="Efectivo"?"green":"blue",class:"text-white",dense:""},{default:t(()=>[r(d(a.tipo_pago.charAt(0)),1)]),_:2},1032,["color"])]),i("td",null,[i("div",ee,d(a.detailsText),1)]),i("td",null,[e(V,{size:"10px",color:a.online?"green":"red",class:"text-white",dense:""},{default:t(()=>[r(d(a.online?"S":"N"),1)]),_:2},1032,["color"])])]))),128)):(u(),x(A,{key:1},[],64))])]),_:1})]),_:1}),e(Q,{modelValue:s.dialogEvento,"onUpdate:modelValue":l[6]||(l[6]=a=>s.dialogEvento=a),persistent:""},{default:t(()=>[e(I,null,{default:t(()=>[e(E,null,{default:t(()=>l[18]||(l[18]=[i("div",{class:"text-h6"},"Seleccionar motivo del evento significativo",-1)])),_:1}),e(E,null,{default:t(()=>[e(D,{modelValue:s.codigoMotivoEvento,"onUpdate:modelValue":l[4]||(l[4]=a=>s.codigoMotivoEvento=a),options:s.eventos,label:"Motivo del evento","emit-value":"","map-options":"",dense:"",outlined:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),e(O,{align:"right"},{default:t(()=>[p(e(k,{flat:"",label:"Cancelar",color:"primary"},null,512),[[v]]),e(k,{flat:"",label:"Guardar",color:"primary",disabled:!s.codigoMotivoEvento,onClick:l[5]||(l[5]=()=>{o.$axios.post("eventoSignificativo",{venta_id:s.venta.id,codigoMotivoEvento:s.codigoMotivoEvento,descripcion:s.eventos.find(a=>a.value===s.codigoMotivoEvento).label}).then(a=>{o.$alert.success("Evento significativo registrado"),s.dialogEvento=!1,c.ventasGet()}).catch(a=>{o.$alert.error(a.response.data.message)})})},null,8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l[19]||(l[19]=i("div",{id:"myElement",class:"hidden"},null,-1))],64)}const he=w(L,[["render",le]]);export{he as default};
