import{_ as y,a5 as v,o as m,a as e,b as a,w as t,Q as h,e as _,d as p,a1 as r,t as i,aq as x,f as b,a6 as g,a7 as q,Z as C,c as Q}from"./index-D7Xk6GjO.js";import{Q as f,a as d,b as c}from"./QMenu-CgzrJreP.js";import{Q as T}from"./QSelect-Cfk1k3Zg.js";import{Q as V,C as w}from"./ClosePopup-C30NQmyp.js";import{Q as k}from"./QChip-CTRdjuvH.js";import{Q as B}from"./QMarkupTable-C2kEUEae.js";import{Q as D}from"./QPage-BKNHMEr0.js";import{h as F}from"./moment-C5S46NFB.js";import{I as A}from"./Imprimir-CwwATIwK.js";import{E}from"./Excel-DYSTQ5HC.js";import"./format-BvkBI9bc.js";import"./_commonjsHelpers-Bx2EM-6T.js";const Y={data(){return{compras:[],fechaInicio:F().format("YYYY-MM-DD"),fechaFin:F().format("YYYY-MM-DD"),user:"",users:[],loading:!1}},mounted(){this.comprasGet(),this.usersGet()},computed:{usersTodos(){return[{label:"Todos",value:""},...this.users.map(o=>({label:o.name,value:o.id}))]},totalCompras(){return this.compras.reduce((o,l)=>l.estado==="Activo"?o+parseFloat(l.total):o,0).toFixed(2)},totalAnuladas(){return this.compras.reduce((o,l)=>l.estado==="Anulado"?o+parseFloat(l.total):o,0).toFixed(2)}},methods:{excel(){const o=[{columns:[{label:"ID",value:"id"},{label:"Fecha",value:l=>`${l.fecha} ${l.hora}`},{label:"Proveedor",value:l=>l.proveedor?.nombre||l.nombre||""},{label:"Usuario",value:l=>l.user?.name||""},{label:"Estado",value:"estado"},{label:"Total (Bs)",value:"total"},{label:"Detalle",value:"detailsText"},{label:"Tipo de pago",value:"tipo_pago"},{label:"Factura",value:"nro_factura"}],content:this.compras}];E.export(o,`Compras_${this.fechaInicio}_a_${this.fechaFin}`)},comprasGet(){this.loading=!0,this.$axios.get("compras",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user}}).then(o=>{this.compras=o.data}).catch(o=>{this.$alert.error(o.response?.data?.message||"Error al obtener compras")}).finally(()=>{this.loading=!1})},usersGet(){this.$axios.get("users").then(o=>{console.log(o.data),this.users=o.data})},imprimir(o){A.reciboCompra(o)},anular(o){this.$alert.dialog("Â¿Anular esta compra?").onOk(()=>{this.loading=!0,this.$axios.put(`comprasAnular/${o}`).then(()=>{this.$alert.success("Compra anulada"),this.comprasGet()})})}}},G={class:"row"},U={class:"col-12 col-md-4 q-pa-xs"},M={class:"col-12 col-md-4 q-pa-xs"},P={class:"col-12 col-md-4 q-pa-xs"},z={class:"row q-col-gutter-sm q-pa-sm"},S={class:"col-12 col-md-2"},N={class:"col-12 col-md-2"},L={class:"col-12 col-md-2"},O={class:"col-12 col-md-2"},Z={class:"col-12 col-md-2"},$={class:"col-12 col-md-2"},j={class:"text-bold"},H={style:{"max-width":"200px","line-height":"1.1"}};function J(o,l,K,R,n,u){return m(),v(g,null,[e(D,{class:"q-pa-xs"},{default:t(()=>[a("div",G,[a("div",U,[e(h,{flat:"",bordered:""},{default:t(()=>[e(_,{class:"q-pa-none"},{default:t(()=>[e(f,{class:"bg-green"},{default:t(()=>[e(d,{avatar:""},{default:t(()=>[e(p,{name:"inventory_2",size:"50px",color:"white"})]),_:1}),e(d,null,{default:t(()=>[e(c,{caption:"",class:"text-white"},{default:t(()=>l[4]||(l[4]=[r("Compras Totales")])),_:1}),e(c,{class:"text-white text-h4"},{default:t(()=>[r(i(u.totalCompras)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",M,[e(h,{flat:"",bordered:""},{default:t(()=>[e(_,{class:"q-pa-none"},{default:t(()=>[e(f,{class:"bg-negative"},{default:t(()=>[e(d,{avatar:""},{default:t(()=>[e(p,{name:"cancel",size:"50px",color:"white"})]),_:1}),e(d,null,{default:t(()=>[e(c,{caption:"",class:"text-white"},{default:t(()=>l[5]||(l[5]=[r("Compras Anuladas")])),_:1}),e(c,{class:"text-white text-h4"},{default:t(()=>[r(i(u.totalAnuladas)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",P,[e(h,{flat:"",bordered:""},{default:t(()=>[e(_,{class:"q-pa-none"},{default:t(()=>[e(f,{class:"bg-indigo"},{default:t(()=>[e(d,{avatar:""},{default:t(()=>[e(p,{name:"inventory_2",size:"50px",color:"white"})]),_:1}),e(d,null,{default:t(()=>[e(c,{caption:"",class:"text-white"},{default:t(()=>l[6]||(l[6]=[r("Total Compras")])),_:1}),e(c,{class:"text-white text-h4"},{default:t(()=>[r(i(n.compras.length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),e(h,{flat:"",bordered:"",class:"q-mt-sm"},{default:t(()=>[e(_,{class:"q-pa-none"},{default:t(()=>[a("div",z,[a("div",S,[e(x,{modelValue:n.fechaInicio,"onUpdate:modelValue":l[0]||(l[0]=s=>n.fechaInicio=s),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),a("div",N,[e(x,{modelValue:n.fechaFin,"onUpdate:modelValue":l[1]||(l[1]=s=>n.fechaFin=s),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),a("div",L,[e(T,{modelValue:n.user,"onUpdate:modelValue":l[2]||(l[2]=s=>n.user=s),options:u.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),a("div",O,[e(b,{color:"primary",label:"Buscar",icon:"search",onClick:u.comprasGet,loading:n.loading,"no-caps":""},null,8,["onClick","loading"])]),a("div",Z,[e(b,{color:"positive",label:"Compra",icon:"add_circle_outline",onClick:l[3]||(l[3]=s=>o.$router.push({name:"compras-create"})),"no-caps":"",loading:n.loading},null,8,["loading"])]),a("div",$,[e(b,{color:"primary",label:"Excel",icon:"file_download",onClick:u.excel,"no-caps":"",loading:n.loading},null,8,["onClick","loading"])])])]),_:1})]),_:1}),e(B,{dense:"","wrap-cells":""},{default:t(()=>[l[9]||(l[9]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",null,"Acciones"),a("th",null,"ID"),a("th",null,"Fecha"),a("th",null,"Factura"),a("th",null,"Proveedor"),a("th",null,"Usuario"),a("th",null,"Estado"),a("th",null,"Total"),a("th",null,"Detalle"),a("th",null,"Pago")])],-1)),a("tbody",null,[(m(!0),v(g,null,q(n.compras,s=>(m(),v("tr",{key:s.id},[a("td",null,[e(V,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:t(()=>[C((m(),Q(f,{clickable:"",onClick:I=>u.imprimir(s)},{default:t(()=>[e(d,{avatar:""},{default:t(()=>[e(p,{name:"print"})]),_:1}),e(d,null,{default:t(()=>l[7]||(l[7]=[r("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[w]]),C((m(),Q(f,{clickable:"",onClick:I=>u.anular(s.id)},{default:t(()=>[e(d,{avatar:""},{default:t(()=>[e(p,{name:"delete"})]),_:1}),e(d,null,{default:t(()=>l[8]||(l[8]=[r("Anular")])),_:1})]),_:2},1032,["onClick"])),[[w]])]),_:2},1024)]),a("td",null,i(s.id),1),a("td",null,i(s.fecha)+" "+i(s.hora),1),a("td",null,i(s.nro_factura),1),a("td",null,i(s.proveedor?.nombre),1),a("td",null,i(s.user?.name),1),a("td",null,[e(k,{color:s.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:t(()=>[r(i(s.estado),1)]),_:2},1032,["color"])]),a("td",j,i(s.total)+" Bs",1),a("td",null,[a("div",H,i(s.detailsText),1)]),a("td",null,[e(k,{color:s.tipo_pago==="Efectivo"?"green":"blue",class:"text-white",dense:""},{default:t(()=>[r(i(s.tipo_pago),1)]),_:2},1032,["color"])])]))),128))])]),_:1})]),_:1}),l[10]||(l[10]=a("div",{id:"myElement",class:"hidden"},null,-1))],64)}const ue=y(Y,[["render",J]]);export{ue as default};
